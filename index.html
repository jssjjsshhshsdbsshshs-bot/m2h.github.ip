<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gartic Rooms Viewer</title>

<style>
body{margin:0;background:#000;color:#eee;font-family:Arial}
.overlay{padding:15px;text-align:center}
h2{color:#ff3c3c;text-shadow:0 0 10px red}
select{padding:6px 12px;border-radius:20px;background:#222;color:#fff;border:1px solid #444}
.flex{display:flex;flex-wrap:wrap;justify-content:center;gap:12px;margin-top:15px}
.card{background:#111;padding:12px;border-radius:12px;min-width:180px;box-shadow:0 0 10px rgba(255,0,0,.4)}
.viewer{display:block;margin-top:8px;color:#fff;text-decoration:none;background:#222;padding:5px;border-radius:6px}
.viewer:hover{background:red}
</style>
</head>

<body>
<div class="overlay">
<h2>Gartic.io Otaqlar</h2>

<select id="lg">
<option value="23" selected>Az…ôrbaycanca</option>
<option value="2">English</option>
<option value="8">T√ºrk√ße</option>
<option value="7">–†—É—Å—Å–∫–∏–π</option>
<option value="3">Espa√±ol</option>
</select>

<div id="total"></div>
<div class="flex" id="rooms"></div>
</div>

<script>
const roomsDiv = document.getElementById("rooms");
const totalDiv = document.getElementById("total");
const select = document.getElementById("lg");

// CORS √º√ß√ºn proxy
const PROXY = "https://api.allorigins.win/raw?url=";

async function loadRooms(lang){
  roomsDiv.innerHTML = "Y√ºkl…ônir...";
  totalDiv.innerHTML = "";

  try{
    const url = PROXY + encodeURIComponent(
      `https://gartic.io/req/list?search=&language[]=${lang}`
    );

    const res = await fetch(url);
    const data = await res.json();

    const active = data.filter(r => r.quant > 0);

    roomsDiv.innerHTML = "";

    if(active.length === 0){
      roomsDiv.innerHTML = "<h3>Otaq tapƒ±lmadƒ±</h3>";
      return;
    }

    active.forEach(r=>{
      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <b>${r.id.slice(1)}</b><br>
        üë• ${r.quant}/${r.max}<br>
        ‚≠ê ${r.points}/${r.goal}
        <a class="viewer" target="_blank"
           href="https://gartic.io/${r.code}/viewer">Viewer</a>
      `;

      roomsDiv.appendChild(card);
    });

    totalDiv.innerText =
      `Total otaq: ${active.length} | Total user: ${active.reduce((a,c)=>a+c.quant,0)}`;

  }catch(e){
    roomsDiv.innerHTML = "X…ôta oldu ‚ùå";
    console.error(e);
  }
}

select.onchange = ()=> loadRooms(select.value);
loadRooms("23");
</script>
</body>
</html>
