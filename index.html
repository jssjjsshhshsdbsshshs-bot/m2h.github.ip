<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gartic.io Bot 2026 (Intercept)</title>
    <style>
        body { background: #111; text-align: center; color: #eee; font-family: sans-serif; }
        input, button { font-size: 18px; padding: 10px 14px; border-radius: 6px; text-align: center; border: none; }
        #grid { display: grid; grid-template-columns: repeat(2, auto); width: 380px; margin: 0 auto; }
        small { margin-bottom: 4px; font-size: 14px; }
        button { background-color: #B7B78A; }
        button:active { transform: scale(0.985); }
        #bb button { width: 380px; margin: 0.5rem 0; }
        hr { width: 420px; border: none; height: 1px; background-color: #aaa; }
        #status { margin: 1rem; font-size: 16px; color: #0f0; }
    </style>
</head>
<body>
    <div style="margin-top: 3rem;"></div>
    <h2>Gartic.io Bot (2026)</h2>
    <p>Əvvəlcə brauzerdə gartic.io aç və otağa gir, sonra buradan JOIN bas.</p>
    
    <div id="grid">
        <small>Otaq kodu (artıq vacib deyil, intercept edir)</small>
        <input type="text" id="rm" placeholder="7100 və ya boş qoy" value="">
    </div>
    
    <div id="bb">
        <button id="bt">JOIN / Activate Bot</button>
        <div id="status">Status: Gözləyir...</div>
    </div>

    <hr>
    <small>Console-da (F12) statusu izlə. Bot işə düşəndə kick üçün ".all" və ya "oyuncuadı" yaz.</small>

<script>
    let ws = null;
    let r = [];     // players list
    let p = null;   // player id (socket id)
    let x = '';     // command buffer

    function activateBot() {
        const statusEl = document.getElementById('status');
        statusEl.textContent = 'Axtarılır... (F12 → Network → WS sekmesine bax)';
        statusEl.style.color = '#ff0';

        // Oyunun mövcud WebSocket-ini tapırıq (ən etibarlı yol)
        const sockets = [];
        for (let key in window) {
            if (window[key] instanceof WebSocket && 
                (window[key].url || '').includes('socket.io') && 
                window[key].readyState === 1) {  // açıq olmalı
                sockets.push(window[key]);
            }
        }

        if (sockets.length > 0) {
            ws = sockets[0];  // adətən 1 ədəd olur
            console.log('Bot WS tapıldı:', ws.url);
            statusEl.textContent = 'Bot aktiv! WS: ' + ws.url.slice(0, 40) + '...';
            statusEl.style.color = '#0f0';

            // Əlavə loglama üçün override edirik (istəsən sil)
            const originalSend = ws.send;
            ws.send = function(data) {
                console.log('Bot göndərir:', data);
                originalSend.apply(ws, arguments);
            };

            // Mövcud mesajları intercept et (kick logic)
            const originalAddEventListener = ws.addEventListener;
            ws.addEventListener('message', handleMessage);
        } else {
            statusEl.textContent = 'WebSocket tapılmadı! Otaqda olmalısan və oyun açıq olmalı.';
            statusEl.style.color = '#f00';
            console.log('Heç bir aktiv socket.io WS tapılmadı. Otağa gir və yenidən cəhd et.');
        }
    }

    function handleMessage(m) {
        let raw = m.data;
        if (typeof raw !== 'string' || !raw.startsWith('42')) return;

        let dataStr = raw.slice(2);
        let d;
        try {
            d = JSON.parse(dataStr);
        } catch(e) {
            return;
        }

        if (d[0] === 5) {
            p = d[2];
            r = d[5] || [];
            console.log('Players yükləndi:', r.length, 'nəfər');
        }

        if (d[0] === 11) {
            x = d[2] ? d[2].trim() : '';

            if (x === '.all') {
                r.forEach(player => {
                    if (ws && ws.readyState === 1) {
                        ws.send(`42[45,\( {p},[" \){player.id}",true]]`);
                    }
                });
                console.log('.all → hamısı kick edildi');
                x = '';
            } else if (x !== '') {
                const target = r.find(a => a.nick === x || a.nick.includes(x));
                if (target) {
                    ws.send(`42[45,\( {p},[" \){target.id}",true]]`);
                    console.log(`Kick göndərildi: \( {x} ( \){target.id})`);
                } else {
                    console.log(`Tapılmadı: ${x}`);
                }
                x = '';
            }
        }

        // Yeni oyunçuya avto-kick (ST‎ ilə başlayanlar istisna)
        if (d[0] === 23 && d[1] && !d[1].nick?.startsWith('ST‎')) {
            if (ws && ws.readyState === 1) {
                ws.send(`42[45,\( {p},[" \){d[1].id}",true]]`);
                console.log('Yeni oyunçu avto-kick:', d[1].nick);
            }
        }
    }

    // JOIN düyməsi
    document.getElementById('bt').onclick = activateBot;

    // Ping saxlamaq üçün (əgər lazım olsa)
    setInterval(() => {
        if (ws && ws.readyState === 1) {
            ws.send('2');
        }
    }, 25000);
</script>
</body>
</html>
