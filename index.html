<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gartic.io Bot – Auto Server Tapma (2026)</title>
    <style>
        body {
            background: #0d0d0d;
            color: #ddd;
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 30px 10px;
        }
        input, button {
            font-size: 18px;
            padding: 12px 18px;
            margin: 8px;
            border-radius: 8px;
            border: none;
        }
        button {
            background: #4caf50;
            color: white;
            cursor: pointer;
        }
        button:hover { background: #388e3c; }
        #status {
            margin: 25px auto;
            font-size: 18px;
            max-width: 500px;
            color: #ff9800;
        }
        #log {
            margin: 20px auto;
            max-width: 600px;
            text-align: left;
            background: #1e1e1e;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>

<h2>Gartic.io Bot – Serveri Özü Tapır</h2>

<div>
    <small>Otaq kodu (məsələn: 7100 və ya 16w)</small><br>
    <input type="text" id="room" placeholder="7100" value="7100">
</div>

<button onclick="startAutoConnect()">QOŞUL (Auto Server)</button>

<div id="status">Status: gözləyir... (server axtarışı başlayacaq)</div>
<div id="log"></div>

<script>
let ws = null;
let currentServerNum = 1;
const maxServer = 15; // 1 → 15 arası yoxla (lazım olsa artır)
let found = false;
let myPlayerId = null;
let players = [];

const status = document.getElementById('status');
const logDiv = document.getElementById('log');

function log(text) {
    logDiv.innerHTML += text + '<br>';
    logDiv.scrollTop = logDiv.scrollHeight;
}

function connectTo(serverNum, roomCode) {
    if (found) return;

    const url = `wss://server${serverNum}.gartic.io/socket.io/?EIO=4&transport=websocket`;
    log(`Cəhd ${serverNum}: ${url}`);

    if (ws && ws.readyState < 2) ws.close();

    ws = new WebSocket(url);

    ws.onopen = () => {
        log(`→ Server ${serverNum} açıldı`);
        status.textContent = `Server ${serverNum} bağlı – qoşulma paketi göndərilir...`;

        // Engine.IO açılış
        ws.send('40');

        setTimeout(() => {
            const nick = "ST‎" + Math.floor(Math.random() * 9000 + 100);
            const joinData = [3, { v: 20000, nick, avatar: 0, lang: "az", sala: roomCode }];
            ws.send('42' + JSON.stringify(joinData));
            log(`Qoşulma paketi göndərildi – ad: ${nick}`);
        }, 600);
    };

    ws.onmessage = (event) => {
        let msg = event.data;
        if (msg.startsWith('40')) {
            log('Engine.IO açılış cavabı alındı');
        }
        if (msg.startsWith('42')) {
            try {
                const data = JSON.parse(msg.slice(2));
                const opcode = data[0];

                if (opcode === 5) { // otaq / oyuncu məlumatı
                    myPlayerId = data[2];
                    players = data[5] || [];
                    found = true;
                    status.textContent = `UĞURLU! Server${serverNum} – Otaqda ${players.length} nəfər`;
                    log('← Otaq məlumatı alındı → Qoşulduq!');
                    // Buradan kick və s. funksiyaları işə sala bilərsən
                }
            } catch(e) {}
        }
    };

    ws.onclose = () => {
        if (!found) {
            log(`Server ${serverNum} bağlandı (uğursuz)`);
            tryNextServer(roomCode);
        }
    };

    ws.onerror = () => {
        if (!found) {
            log(`Xəta: Server ${serverNum}`);
            tryNextServer(roomCode);
        }
    };
}

function tryNextServer(roomCode) {
    if (found || currentServerNum > maxServer) {
        if (!found) {
            status.textContent = 'Server tapılmadı. Otaq kodunu və ya maxServer sayını yoxla.';
            log('Axtarış bitdi – heç bir server tapılmadı.');
        }
        return;
    }
    currentServerNum++;
    setTimeout(() => connectTo(currentServerNum, roomCode), 800); // delay qoyuruq ban yeməmək üçün
}

function startAutoConnect() {
    const roomCode = document.getElementById('room').value.trim() || '7100';
    if (!roomCode) return alert('Otaq kodunu daxil et!');

    found = false;
    currentServerNum = 1;
    logDiv.innerHTML = '';
    status.textContent = 'Server axtarışı başlayır...';
    log('Axtarış başladı – otaq: ' + roomCode);

    connectTo(1, roomCode);
}

// Ping interval (bütün serverlər üçün)
setInterval(() => {
    if (ws && ws.readyState === 1) {
        ws.send('2');
    }
}, 24000);
</script>

</body>
</html>
