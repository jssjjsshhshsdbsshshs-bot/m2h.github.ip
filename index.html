<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gartic.io bot 2026</title>
    <style type="text/css">
        body{background: #111;text-align: center;color: #eee;font-family: sans-serif;}
        #sr{width: 100px}
        input,button{font-size: 18px;padding: 10px 14px;border-radius: 6px;text-align: center;border: none;}
        #grid{display: grid;grid-template-columns: repeat(2, auto);width: 380px;margin: 0 auto;}
        small{margin-bottom: 4px;font-size: 14px}
        button{background-color: #B7B78A;}
        button:active{transform: scale(0.985);}
        #bb button{width: 380px} 
        hr{width: 420px;border: none;height: 1px;background-color: #aaa;}
    </style>
</head>
<body>
    <div style="margin-top: 3rem;"></div>
    <div id="grid">
        <small>Server (artıq vacib deyil)</small>
        <small>Otaq kodu</small>
        <input type="text" id="sr" placeholder="server" value="server" disabled>
        <input type="text" id="rm" placeholder="7100">
    </div>
    <div id="bb" style="margin-top: 0.5rem;">
        <button id="ab">AB</button>
        <button onclick="j(document.getElementById('rm').value)" id="bt">JOIN</button>
    </div>

<script>
    let r = [];
    let p, x;
    let ws = '';

    function j(b){  // artıq server parametri qəbul etmir
        if(ws != '' && ws.readyState == 1){
            ws.close();
        }

        // 2025–2026 üçün ən çox işləyən variantlar (sırayla yoxla)
        // ws = new WebSocket(`wss://server.gartic.io/socket.io/?EIO=3&transport=websocket`);
        ws = new WebSocket(`wss://gartic.io/socket.io/?EIO=3&transport=websocket`);

        // Əgər yuxarıdakı işləmirsə bu sətiri aktiv et (şərh aç):
        // ws = new WebSocket(`wss://play.gartic.io/socket.io/?EIO=3&transport=websocket`);

        ws.onopen = () => {
            // nickdəki görünməz simvolu saxladım, amma bəzən bloklanır — istəsən sil
            ws.send(`42[3,{"v":20000,"nick":"ST‎\( {Math.floor(Math.random() * 960)}","avatar":0,"sala":" \){b}"}]`);
            ws.send(`42[46,${Date.now()}]`);  // timestamp daha aktual olsun
        }

        ws.onmessage = (m) => {
            // bəzən binary frame gəlir → slice(2) yerinə daha təhlükəsiz yoxlama
            let raw = m.data;
            if (typeof raw !== 'string') return;

            let dataStr = raw.startsWith('42') ? raw.slice(2) : raw;
            let d;
            try {
                d = JSON.parse(dataStr);
            } catch(e) {
                return;
            }

            if(d[0] == 5){
                p = d[2];
                r = d[5] || [];
            }

            if(d[0] == 11){
                x = d[2];

                if(x == '.all'){
                    for(let i = 0; i < r.length; i++){
                        ws.send(`42[45,\( {p},[" \){r[i].id}",true]]`);
                    }
                    x = '';
                }
                else if(x != ''){
                    let target = r.find(a => a.nick === x);
                    if (target) {
                        ws.send(`42[45,\( {p},[" \){target.id}",true]]`);
                    }
                    x = '';
                }
            }

            else if(d[0] == 23 && !d[1].nick?.startsWith('ST‎')){
                ws.send(`42[45,\( {p},[" \){d[1].id}",true]]`);
            }
        }
        
        // ping intervalı bir az artırdım ki ban riski azalsın
        setInterval(() => {
            if (ws.readyState === 1) ws.send(`2`);
        }, 30000);
    }
</script>
</body>
</html>
