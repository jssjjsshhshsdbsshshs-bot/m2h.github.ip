<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gartic Rooms Viewer</title>

<style>
body{margin:0;background:#000;color:#eee;font-family:Arial}
.overlay{padding:15px;text-align:center}
h2{color:#ff3c3c;text-shadow:0 0 8px red}
select{padding:6px 12px;border-radius:20px;background:#222;color:#fff;border:1px solid #444}
.flex{display:flex;flex-wrap:wrap;justify-content:center;gap:12px;margin-top:15px}
.card{background:#111;padding:12px;border-radius:12px;min-width:180px;box-shadow:0 0 10px rgba(255,0,0,.4)}
.card img{width:32px}
.viewer{display:block;margin:6px auto 0;padding:4px 0;width:80px;border-radius:6px;background:#222;color:#fff;text-decoration:none}
.viewer:hover{background:red}
</style>
</head>

<body>
<div class="overlay">
<h2>Gartic.io Rooms</h2>

<select id="lang">
<option value="23">Azərbaycanca</option>
<option value="2">English</option>
<option value="8">Türkçe</option>
<option value="7">Русский</option>
<option value="1">Português</option>
<option value="3">Español</option>
</select>

<div id="rooms" class="flex"></div>
<p id="status"></p>
</div>

<script>
const roomsDiv = document.getElementById("rooms");
const statusP = document.getElementById("status");

const proxies = [
  "https://cors.isomorphic-git.org/",
  "https://thingproxy.freeboard.io/fetch/",
  "https://api.allorigins.win/raw?url=",
];

async function fetchWithProxy(url){
  for(const p of proxies){
    try{
      const r = await fetch(p + url, {cache:"no-store"});
      if(r.ok) return await r.json();
    }catch(e){}
  }
  throw "All proxies failed";
}

async function loadRooms(lang){
  roomsDiv.innerHTML = "";
  statusP.textContent = "Yüklənir...";

  try{
    const url = `https://gartic.io/req/list?search=&language[]=${lang}`;
    const data = await fetchWithProxy(url);

    const rooms = data.filter(x=>x.quant>0);
    statusP.textContent = `Tapılan otaqlar: ${rooms.length}`;

    if(!rooms.length){
      roomsDiv.innerHTML = "<h3>Otaq yoxdur</h3>";
      return;
    }

    rooms.forEach(r=>{
      const d = document.createElement("div");
      d.className = "card";
      d.innerHTML = `
        <h4>${r.id.slice(1)}</h4>
        <img src="https://gartic.io/static/images/subjects/${r.subject}.svg">
        <p>${r.quant}/${r.max} ・ ${r.points}/${r.goal}</p>
        <a class="viewer" target="_blank" href="https://gartic.io/${r.code}/viewer">Viewer</a>
      `;
      roomsDiv.appendChild(d);
    });

  }catch(e){
    statusP.textContent = "Bütün proxy-lər bloklandı ❌";
  }
}

document.getElementById("lang").onchange = e => loadRooms(e.target.value);
loadRooms("23");
</script>
</body>
</html>
