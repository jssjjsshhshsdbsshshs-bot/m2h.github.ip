<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WhoWhere V2 - Gartic.io</title>
<style>
    body { background-color: #111; color: #eee; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align:center; margin:0; padding:0; }
    .overlay {
        position: fixed; top:0; left:0; width:100%; height:100%;
        background-color:#000; color:#f0f0f0; z-index:9999; overflow-y:auto;
        text-align:center; padding:20px;
    }
    .overlay h2 {
        color:#ff3c3c;
        text-shadow: 0 0 8px #ff3c3c, 0 0 16px #ff0000;
        margin-bottom: 10px;
    }
    .flex { display:flex; justify-content:center; flex-wrap:wrap; gap:12px; margin-top:1rem; }
    .flex-child {
        background: #111; padding:12px 18px; min-width:180px; border-radius:12px;
        box-shadow: 0 0 12px rgba(255,0,0,0.5);
        display:flex; flex-direction:column; align-items:center; transition: transform 0.2s, box-shadow 0.2s;
    }
    .flex-child:hover { transform: translateY(-5px); box-shadow: 0 0 20px rgba(255,0,0,0.8); }
    .flex-child img { width:32px; height:32px; border-radius:50%; border:1px solid #666; margin-bottom:6px; }
    .users .user-info { display:flex; align-items:center; margin-bottom:6px; justify-content:flex-start; }
    .users .user-info p { margin-left:6px; font-size:13px; color:#ccc; overflow-wrap:anywhere; }
    select {
        font-size:16px; padding:6px 12px; border-radius:30px;
        background-color:#222; color:white; border:1px solid #444; margin-bottom:10px;
    }
    .viewer-btn {
        display:block; width:80px; margin:6px auto 12px auto;
        padding:4px 0; border-radius:6px; background-color:#222;
        color:#fff; text-decoration:none; font-weight:bold; text-align:center;
        font-size:12px;
        box-shadow:0 0 6px rgba(255,0,0,0.5); transition: all 0.2s;
    }
    .viewer-btn:hover { background-color:#ff0000; box-shadow:0 0 12px rgba(255,0,0,0.8); }
    #totalCount { position: fixed; top: 50px; left: 10px; background-color: darkslateblue; color:white; padding:5px 10px; border-radius:5px; z-index:9999; }
    #closeBtn, #openBtn {
        position: fixed; padding: 5px 10px; border:none; border-radius:5px; cursor:pointer; color:white; z-index:9999;
    }
    #closeBtn { top:10px; right:10px; background-color: darkred; }
    #openBtn { bottom:10px; right:10px; background-color: darkgreen; display:none; }
</style>
</head>
<body>

<div class="overlay" id="overlay">
    <header><h2>M2H</h2></header>
    <p>Hazırki Otağlar</p>
    <button id="closeBtn">X</button>
    <select id="lg">
        <option value="23" selected>Azərbaycanca</option>
        <option value="1">Português</option>
        <option value="2">English</option>
        <option value="3">Español</option>
        <option value="4">Français</option>
        <option value="5">Italiano</option>
        <option value="6">Deutsch</option>
        <option value="7">Русский</option>
        <option value="8">Türkçe</option>
        <option value="9">Polski</option>
        <option value="10">Nederlands</option>
        <option value="11">Čeština</option>
        <option value="12">Magyar</option>
        <option value="13">Română</option>
        <option value="14">Українська</option>
        <option value="15">Svenska</option>
        <option value="16">Suomi</option>
        <option value="17">Dansk</option>
        <option value="18">Norsk</option>
        <option value="19">العربية</option>
        <option value="20">فارسی</option>
        <option value="21">한국어</option>
        <option value="22">日本語</option>
        <option value="24">हिन्दी</option>
        <option value="25">ไทย</option>
        <option value="26">Bahasa Indonesia</option>
        <option value="27">Tiếng Việt</option>
        <option value="28">中文</option>
    </select>
    <div class="flex" id="flexDiv"></div>
</div>

<button id="openBtn">Open</button>
<div id="totalCount"></div>

<script>
const overlay = document.getElementById('overlay');
const closeBtn = document.getElementById('closeBtn');
const openBtn = document.getElementById('openBtn');
const select = document.getElementById('lg');
const flexDiv = document.getElementById('flexDiv');
const totalCountDisplay = document.getElementById('totalCount');

closeBtn.onclick = () => { overlay.style.display='none'; openBtn.style.display='block'; }
openBtn.onclick = () => { overlay.style.display='block'; openBtn.style.display='none'; }

async function f(lang){
    try {
        const res = await fetch(`https://gartic.io/req/list?search=&language[]=${lang}`);
        const data = await res.json();
        const active = data.filter(room => room.quant > 0);

        if(active.length===0){
            flexDiv.innerHTML='<h2>Seçilən dildə otağ yoxdur.</h2>';
            totalCountDisplay.textContent='';
            return;
        }

        flexDiv.innerHTML='';

        for(const room of active){
            const flc = document.createElement('div');
            flc.className='flex-child';
            flexDiv.appendChild(flc);

            const roomTag = document.createElement('h3');
            roomTag.innerText = room.id.slice(1);

            const roomSubjIcon = document.createElement('img');
            roomSubjIcon.src = `https://gartic.io/static/images/subjects/${room.subject}.svg`;

            const inRoomPlayers = document.createElement('p');
            inRoomPlayers.innerText = `${room.quant} / ${room.max} ・ ${room.points} / ${room.goal}`;

            const users = document.createElement('div');
            users.className='users';

            const viewBtn = document.createElement('a');
            viewBtn.href = `https://gartic.io/${room.code}/viewer`;
            viewBtn.target='_blank';
            viewBtn.innerText='Viewer';
            viewBtn.className='viewer-btn';

            flc.append(roomTag, roomSubjIcon, inRoomPlayers, users, viewBtn);

            // Viewer users WebSocket üçün GitHub Pages-də işləməyəcək CORS səbəbindən
            // Bu səbəbdən sadəcə Viewer link göstəririk
        }

        totalCountDisplay.innerText = `Total Otağ: ${active.length}, Total User: ${active.reduce((a,c)=>a+c.quant,0)}`;
    } catch(e){ console.error(e); }
}

select.onchange = function(){ f(this.value); }
f('23');
</script>

</body>
</html>
