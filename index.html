<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gartic.io Bot 2026 - WS</title>
<style>
body{background:#111;color:#eee;font-family:sans-serif;text-align:center;}
input,button{font-size:18px;padding:10px 14px;border-radius:6px;border:none;}
#grid{display:grid;grid-template-columns:repeat(2,auto);width:380px;margin:0 auto;}
#bb button{width:380px;margin-top:0.5rem;}
</style>
</head>
<body>

<h2>Gartic.io Bot 2026</h2>

<div id="grid">
    <small>Otaq kodu</small>
    <input type="text" id="rm" placeholder="7100">
</div>
<div id="bb">
    <button onclick="joinRoom()">JOIN / Activate Bot</button>
</div>

<script>
let ws = null;
let selfId = null;
let players = [];

function joinRoom() {
    const room = document.getElementById('rm').value.trim();
    if(!room) return alert("Otaq kodunu yaz!");

    // Ən son server URL (2026)
    const wsUrl = `wss://server0.gartic.io/socket.io/?EIO=3&transport=websocket`;
    ws = new WebSocket(wsUrl);

    ws.onopen = () => {
        console.log("[BOT] WS açıldı:", wsUrl);
        // Otağa qoşulmaq
        ws.send(`42["3",{"v":20000,"nick":"Bot_${Math.floor(Math.random()*1000)}","avatar":0,"sala":"${room}"}]`);
        // Ping
        setInterval(()=>{ if(ws.readyState===1) ws.send('2'); },30000);
    };

    ws.onmessage = (msg) => {
        if(typeof msg.data!=="string") return;
        if(!msg.data.startsWith('42')) return;

        let d;
        try { d = JSON.parse(msg.data.slice(2)); } catch(e){ return; }

        // Self ID və mövcud oyunçular
        if(d[0]==5){
            selfId = d[2];
            players = d[5] || [];
            console.log("[PLAYERS]", players.map(p=>p.nick));
        }

        // Chat / kick
        if(d[0]==11){
            const chat = d[2]?.trim();
            if(!chat) return;

            // .all → bütün oyunçuları kick
            if(chat==='.all'){
                players.forEach(p=>{
                    ws.send(`42["45",${selfId},["${p.id}",true]]`);
                });
                console.log("[ALL KICKED]");
            }
            else{
                const target = players.find(p=>p.nick.toLowerCase()===chat.toLowerCase());
                if(target){
                    ws.send(`42["45",${selfId},["${target.id}",true]]`);
                    console.log("[KICKED]", target.nick);
                }
            }
        }

        // Yeni oyunçu gəldi → avtomatik kick (ST ilə başlayanlar istisna)
        if(d[0]==23 && d[1] && !d[1].nick?.startsWith('ST')){
            ws.send(`42["45",${selfId},["${d[1].id}",true]]`);
            console.log("[AUTO KICK]", d[1].nick);
        }

        // Yeni oyunçuları map-ə əlavə et
        if(d[0]==23 && d[1]){
            if(!players.some(p=>p.id===d[1].id)) players.push(d[1]);
        }
    };

    ws.onerror = (e)=>console.error("[WS ERROR]", e);
    ws.onclose = ()=>console.log("[WS CLOSED]");
}
</script>

</body>
</html>
